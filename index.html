<style>
.bar-container {
	margin: 2px 0;
}
</style>

<p>Paste numbers, get bar graph PNGs.
<p><textarea id="numbers" rows="8">10
20
30
50
90
40</textarea>
<hr />
<div id="bars"></div>

<script src="jquery.js"></script>
<script src="pnglib.js"></script>
<script>
var imageData = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAAAAAAALAAAAAABAAEAAAICTAEAOw==";
var $numbers = $('#numbers');
var $bars = $('#bars');

$numbers.on('input propertychange', function () {
	var numbers = $(this).val().split('\n').map(function (n) { return parseFloat(n) });
	var min = 0;
	var max = numbers.slice().filter(isFinite).sort(function (a, b) { return b-a })[0];
	var barmin = 3, barmax = 200;
	$bars.empty();
	numbers.forEach(function (n) {
		var $container = $('<div />').addClass('bar-container').appendTo($bars);
		if (isFinite(n)) {
			var $img = barImage(barmax, 10, barmin + (n - min) / (max - min) * (barmax - barmin));
			$container.append($img);
		} else {
			$container.css({ height: 10 });
		}
	});
});
$numbers.trigger('input');

function barImage(width, height, barwidth) {
	width = Math.max(Math.round(width), 1);
	height = Math.max(Math.round(height), 1);
	var p = new PNGlib(width, height, 256); // constructor takes height, weight and color-depth
	p.color(0, 0, 0, 0); // set the background
	
	for (var x = 0; x < barwidth; x++) {
		for (var y = 0; y < height; y++) {
			p.buffer[p.index(x, y)] = p.color(0xcc, 0xcc, 0xcc);
		}
	}
	
	return $('<img />').attr('src', 'data:image/png;base64,'+p.getBase64());
}

</script>
